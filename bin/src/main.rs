use cwextab::{decode_extab, ExceptionTableData};


//Test code


const EXTAB_DATA: [u8; 344] = [
    0x20, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x00, 0x02, 0x00, 0x28, 0x00, 0x00, 0x00, 0x74,
    0x00, 0x00, 0x00, 0x94, 0x00, 0x00, 0x00, 0x98, 0x00, 0x00, 0x00, 0xC4, 0x00, 0x00, 0x00, 0xA4,
    0x00, 0x00, 0x01, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x21, 0x9C,
    0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x21, 0x6C, 0x00, 0x00, 0x00, 0x00,
    0x07, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x20, 0xC8, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1E,
    0x00, 0x00, 0x01, 0xA8, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x00, 0x64,
    0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00,
    0x07, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1E,
    0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x86, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1C, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00,
    0x07, 0x80, 0x00, 0x1D, 0x00, 0x00, 0x00, 0x9C, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1E,
    0x00, 0x00, 0x21, 0x9C, 0x00, 0x00, 0x00, 0x00, 0x87, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x21, 0x6C,
    0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1D, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00,
    0x07, 0x80, 0x00, 0x1C, 0x00, 0x00, 0x1E, 0xF4, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1C,
    0x00, 0x00, 0x1E, 0xDC, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x21, 0x9C,
    0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x21, 0x6C, 0x00, 0x00, 0x00, 0x00,
    0x87, 0x80, 0x00, 0x1E, 0x00, 0x00, 0x20, 0xC8, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1C,
    0x00, 0x00, 0x1E, 0xF4, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1C, 0x00, 0x00, 0x1E, 0xDC,
    0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1C, 0x00, 0x00, 0x1E, 0xC4, 0x00, 0x00, 0x00, 0x00,
    0x07, 0x80, 0x00, 0x1C, 0x00, 0x00, 0x1E, 0xBC, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1C,
    0x00, 0x00, 0x1E, 0xB4, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1C, 0x00, 0x00, 0x1D, 0xC8,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0xE8,
];

const EXTAB_FUNCS: [&str; 25] = [
    "__dt__Q22cf7CVisionFv",
    "__dt__Q22cf12CSuddenCommuFv",
    "__dt__800D8DBC",
    "__dt__800D8B9C",
    "__dt__reslist_cf_IBattleEvent",
    "__dt__reslist_cf_CfObjectActor",
    "__dt__reslist_cf_CfObjectActor",
    "__dt__reslist_cf_CfObjectActor",
    "__dt__800D8884",
    "__dt__Q22cf12CChainEffectFv",
    "__dt__Q22cf11CChainTimerFv",
    "__dt__Q22cf7CVisionFv",
    "__dt__Q22cf12CSuddenCommuFv",
    "__dt__Q22cf12CChainEffectFv",
    "__dt__Q22cf11CChainComboFv",
    "__dt__Q22cf12CChainChanceFv",
    "__dt__Q22cf7CVisionFv",
    "__dt__Q22cf12CSuddenCommuFv",
    "__dt__800D8DBC",
    "__dt__Q22cf11CChainComboFv",
    "__dt__Q22cf12CChainChanceFv",
    "__dt__Q22cf10CChainTimeFv",
    "__dt__Q22cf11CChainTimerFv",
    "__dt__Q22cf11CChainTimerFv",
    "__dt__Q22cf12CChainMemberFv",
];


fn test_decode(){
	let result = decode_extab(&EXTAB_DATA);
	let data: ExceptionTableData =
    match result {
        Some(val) => val,
        None => { 
			panic!("Something went wrong with decoding :<");
		},
    };
	println!("{}",data.pc_actions[0].action_offset);

	//Convert the table struct to a string and print it.
	let result = data.to_string(&EXTAB_FUNCS);
    let text : String =
    match result {
        Some(val) => val,
        None => {
			panic!("Something went wrong with converting to text :<");
		},
    };
    
    println!("{}", text);
}

fn main() {
	//println!("WIP, not meant to be used yet.");
	test_decode();
}